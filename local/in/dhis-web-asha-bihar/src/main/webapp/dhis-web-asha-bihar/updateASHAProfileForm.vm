<script type="text/javascript" src="javascript/addASHA.js"></script>
#macro( validate $type $require )
  #if( $type == "NUMBER" )
  	{validate:{ number:true #if($require), required:true #end }}
  #elseif( $type == "string" )
  	{validate:{ alphanumeric:true #if($require), required:true #end }}
  #elseif( $require )
  	{validate:{required:true}}
  #end
#end

<script>
	
	jQuery(document).ready(	function(){

		datePickerValid( 'updateASHAProfileForm [id=deathDate]' );
		addEventForASHAForm('updateASHAProfileForm');
		
		jQuery("#updateASHAProfileForm").validate({
			 meta:"validate"
			,errorElement:"span"
			,submitHandler: function(form)
				{
					validateUpdateASHAProfile();
				}
			,beforeValidateHandler: function(form)
				{
					var dobType = $('#updateASHAProfileForm [id=dobType]').val();
					if( dobType=='V' || dobType=='D' ) 
					{
						var birthDate = $('#updateASHAProfileForm [id=birthDate]').val();
						if( birthDate != '' ){
							$("#updateASHAProfileForm [id=memberValidator]").val(birthDate);
						}
					}else{
						var age = $('#updateASHAProfileForm [id=age]').val();
						$("#updateASHAProfileForm [id=memberValidator]").val(age);
					}
				}
		});
		
		checkedDuplicate = false;
		if("$!patient.dobType" == 'A'){ 
			//var i18n_please_select_relationshipType = '$encoder.jsEscape( $i18n.getString( "please_verify_birthday" ) , "'")';
			//jQuery('#patientForm [id=birthDate]').css("display","none");
			//alert(i18n_please_select_relationshipType);
		}
		else{
			datePickerValid( 'updateASHAProfileForm [id=birthDate]' );
			jQuery('#updateASHAProfileForm [id=age]').css("display","none");
		}
	});
	
</script>

<h4>$i18n.getString( "update_asha" ) Demographics and Work Related Information</h4>
<p>
<form id="updateASHAProfileForm" name="updateASHAProfileForm"  method="post" >

<input type="hidden" id="attributeGroupId" name="attributeGroupId" value="$attributeGroup.id">
<input type="hidden" id="attributeGroupName" name='attributeGroupName' value="$!attributeGroup.name"/>
<input type="hidden" id="id" name="id" value="$patient.id">
<!--
<input type="hidden" id="representativeId" name="representativeId" value='$!patient.representative.id' /> 
<input type="hidden" id="relationshipTypeId" name='relationshipTypeId' value="$!relationship.relationshipType.id"/>
<input type="hidden" id="id" name="id" value="$patient.id">
-->
<table style="background-color:#ECE0F8;" width="100%">		
	<tr>
		<td class='text-column'>$i18n.getString( "system_identifier" )</td>
		<td>$!systemIdentifier</td>
	</tr>	

	<tr>
		<th colspan="2" class="heading-column"><strong>Section 1: Demographics and Work Related Information</strong></th>
	</tr>
	
	<tr>
		<td class='text-column'><label for="fullName">$i18n.getString( "full_name_asha" )</label></td>
		<td class="input-column"><input type="text" id="fullName" name="fullName" value="$!patient.getFullName()" class="{validate:{required:true, unicodechars:true, rangelength:[7,50]}}"></td>
	</tr>
	
	<tr style='display:none'>
		<td class='text-column'><label for="gender">$i18n.getString( "gender" )<em title="$i18n.getString( "required" )" class="required">*</em></label></td>
		<td class="input-column">
			<select id="gender" name="gender">
				<option value="M" #if( $!patient.gender == 'M' ) selected="selected" #end>$i18n.getString( "male" )</option>
				<option value="F" #if( $!patient.gender == 'F' ) selected="selected" #end>$i18n.getString( "female" )</option>
			</select>
		</td>
	</tr>

	<tr #alternate( false ) id="trattr6">	    
		<!-- Village Name of ASHA -->
		<td class='text-column'>Village Name</td>
		<td class="input-column" ><input type="text" id="attr6" name="attr6" class="{validate:{required:false ,unicodechars:true }}" value = "$!patientAttributeValueMap.get( 6 )" /></td>
	</tr>	


	<tr #alternate( false ) id="trattr19">	    
		<!-- Population of Village of ASHA -->
		<td class='text-column'>Population of Village</td>
		<td class="input-column" ><input type="text" id="attr19" name="attr19" class="{validate:{required:false ,number:true }}" value = "$!patientAttributeValueMap.get( 19 )" /></td>
	</tr>
	
	<tr #alternate( false ) id="trattr200">	    
		<!-- Name of ANM In-charge of ASHA -->
		<td class='text-column'>Name of ANM In-charge</td>
		<td class="input-column" ><input type="text" id="attr200" name="attr200" class="{validate:{required:false ,unicodechars:true }}" value = "$!patientAttributeValueMap.get( 200 )" /></td>
	</tr>
	
	<tr #alternate( false ) id="trattr201">	    
		<!-- Name of ASHA Facilitator In-charge -->
		<td class='text-column'>Name of ASHA Facilitator</td>
		<td class="input-column" ><input type="text" id="attr201" name="attr201" class="{validate:{required:false ,unicodechars:true }}" value = "$!patientAttributeValueMap.get( 201 )" /></td>
	</tr>


	
	<tr>
		<td class='text-column' ><label for="birthDate">$i18n.getString( "date_of_birth" )<em title="$i18n.getString( 'required' )" class="required">*</em></label></td>
		<td class="input-column">
			<select id='dobType' name="dobType" style='width:120px' onchange='dobTypeOnChange("updateASHAProfileForm")' >
				<!--<option value="V" #if($patient.dobType=='V') selected #end >$i18n.getString( "verified" )</option>-->
				<option value="D" #if($patient.dobType=='D') selected #end >$i18n.getString( "declared" )</option>
				<option value="A" #if($patient.dobType=='A') selected #end >$i18n.getString( "approximated" )</option>
			</select>
			<input type="text" id="birthDate" name="birthDate" value='$format.formatDate($!patient.birthDate)' style='width:136px;' onchange="dobValidation();"/> 
			<input type="text" id="age" name="age" placeholder="Enter age in years..." value='$!patient.getIntegerValueOfAge()' class="{validate:{number:true}}" style='width:136px;' onchange="ageValidation();"/>
		</td>
	</tr>

	<tr style='display:none'>
		<td></td>
		<td class="input-column">
			<input id="memberValidator" class="hidden {validate:{required:true}}"/>
		</td>
	</tr>
	
	<tr>
		<td class='text-column'><label for="phoneNumber">$i18n.getString( "phoneNumber" )</label></td>
		<td class="input-column">
			<input type="text" id="phoneNumber" name="phoneNumber" value="$!patient.phoneNumber" #if( $!patient.phoneNumber ) value="$!patient.phoneNumber" #else value="$!phoneNumberAreaCode" #end class="{validate:{phone:true,rangelength:[10,10]}}"/>
		</td>
	</tr>
	
	<tr #alternate( false ) id="trattr12">	    
		<!-- Educational level of ASHA -->
		<td class='text-column'>Educational level</td>
		<td class="input-column" >
			#set( $attribute = $patientAttributeMap.get( 12 ) )
			#set( $attributeValueEducational = $!patientAttributeValueMap.get( 12 ) )	
			<select id="attr12" name="attr12" onchange="validateEducationLevel();">
			 	<option value="" selected="selected">[$i18n.getString( "please_select" )]</option>
			 	##foreach ($option in $attribute.attributeOptions )
			 		<option value="2" #if($attributeValueEducational == "Post Graduate" ) selected="selected" #end >Post Graduate</option>
			 		<option value="5" #if($attributeValueEducational == "Graduate" ) selected="selected" #end >Graduate</option>
			 		<option value="4" #if($attributeValueEducational == "10+2" ) selected="selected" #end >10+2</option>
			 		<option value="3" #if($attributeValueEducational == "Matriculation" ) selected="selected" #end >Matriculation</option>
			 		<option value="6" #if($attributeValueEducational == "8th Pass" ) selected="selected" #end >8th Pass</option>
			 		<option value="7" #if($attributeValueEducational == "Primary" ) selected="selected" #end >Primary</option>
			 		<option value="1" #if($attributeValueEducational == "Illiterate" ) selected="selected" #end >Illiterate</option>
			 		<option value="194" #if($attributeValueEducational == "Enrolled in 10th Grade through Open School/IGNOU" ) selected="selected" #end >Enrolled in 10th Grade through Open School/IGNOU</option>
	 			##end
 			</select>
 		</td>
	</tr>	


	<tr #alternate( false ) id="trattr202">	    
		<!-- Year of Enrollment of ASHA -->
		<td class='text-column'>Year of Enrollment</td>
		<td class="input-column" ><input type="text" id="attr202" name="attr202" class="{validate:{required:false ,number:true }}" value = "$!patientAttributeValueMap.get( 202 )" /></td>
	</tr>

	

	<tr #alternate( false ) id="trattr13">	    
		<!-- Caste Category of ASHA -->
		<td class='text-column'>Caste Category</td>
		<td class="input-column" >
			#set( $attribute = $patientAttributeMap.get( 13 ) )
			#set( $attributeValueCaste = $!patientAttributeValueMap.get( 13 ) )		
			<select id="attr13" name="attr13" class='#validate( "default"  $attribute.mandatory )'>
			 	<option value="" selected="selected">[$i18n.getString( "please_select" )]</option>
			 	##foreach ($option in $attribute.attributeOptions )
			 		<option value="11" #if( $attributeValueCaste == "SC" ) selected="selected" #end >SC</option>
			 		<option value="217" #if( $attributeValueCaste == "ST" ) selected="selected" #end >ST</option>
			 		<option value="10" #if( $attributeValueCaste == "OBC" ) selected="selected" #end >OBC</option>
			 		<option value="9" #if( $attributeValueCaste == "General" ) selected="selected" #end >General</option>
			 		<option value="8" #if( $attributeValueCaste == "Others" ) selected="selected" #end >Others</option>
	 			##end
	 			</select>
	 		</td>
	</tr>


	<tr #alternate( false ) id="trattr14">	    
		<!-- Marital Status  of ASHA -->
		<td class='text-column'>Marital Status</td>
		<td class="input-column" >
			#set( $attribute = $patientAttributeMap.get( 14 ) )
			#set( $attributeValueMarital = $!patientAttributeValueMap.get( 14 ) )	
			<select id="attr14" name="attr14" class='#validate( "default"  $attribute.mandatory )'>
			 	<option value="" selected="selected">[$i18n.getString( "please_select" )]</option>
			 	##foreach ($option in $attribute.attributeOptions )
			 		<option value="12" #if($attributeValueMarital == "Married" ) selected="selected" #end >Married</option>
			 		<option value="13" #if($attributeValueMarital == "Married but currently Single" ) selected="selected" #end >Married but currently Single</option>
			 		<option value="14" #if($attributeValueMarital == "Unmarried" ) selected="selected" #end >Unmarried</option>
			 		<option value="15" #if($attributeValueMarital == "Widow" ) selected="selected" #end >Widow</option>
	 			##end
 			</select>
 		</td>
	</tr>

	<tr #alternate( false ) id="trattr23">	    
		<!-- Other source of Income -->
		<td class='text-column'>Other source of Income</td>
		<td class="input-column" >
			#set( $attribute = $patientAttributeMap.get( 23 ) )
			#set( $attributeValueOtherSourceIncome = $!patientAttributeValueMap.get( 23 ) ) 
            <select id="attr23" name="attr23" class='#validate( "default"  $attribute.mandatory )'>
                <option value="" selected="selected">[$i18n.getString( "please_select" )]</option>
                <option value="true" #if( $attributeValueOtherSourceIncome =='true') selected="selected" #end >$i18n.getString( "yes" )</option>
                <option value="false" #if( $attributeValueOtherSourceIncome =='false') selected="selected" #end >$i18n.getString( "no" )</option>
            </select>
		</td>
	</tr>
	
	<tr #alternate( false ) id="trattr10">	    
		<!-- Date of Appointment as ASHA -->
		<td class='text-column'>Date of Appointment as ASHA</td>
		#set( $attributeDate = $patientAttributeMap.get( 15 ) )
		<td class="input-column" ><input type="text" id="attr15" name="attr15" class=' #validate( "default"  $attributeDate.mandatory )' value = "$!patientAttributeValueMap.get( 15 )" onchange="validateDateOfJoining();"/>
    		<script type="text/javascript">
    			datePickerValid( 'attr15' );
    		</script>
		</td>
	</tr>
	

	<tr #alternate( false ) id="trattr16">	    
		<!-- Letter from Panchayat -->
		<td class='text-column'>Letter from Panchayat</td>
		<td class="input-column" >
			#set( $attribute = $patientAttributeMap.get( 16 ) )
			#set( $attributeValueRecommendation = $!patientAttributeValueMap.get( 16 ) )
            <select id="attr16" name="attr16" class='#validate( "default"  $attribute.mandatory )'>
                <option value="" selected="selected">[$i18n.getString( "please_select" )]</option>
                <option value="true" #if( $attributeValueRecommendation =='true') selected="selected" #end>$i18n.getString( "yes" )</option>
                <option value="false" #if( $attributeValueRecommendation =='false') selected="selected" #end>$i18n.getString( "no" )</option>
            </select>
		</td>
	</tr>


	<tr #alternate( false ) id="trattr17">	    
		<!-- Identity Card Issued -->
		<td class='text-column'>Identity Card Issued</td>
		<td class="input-column" >
			#set( $attribute = $patientAttributeMap.get( 17 ) )
			#set( $attributeValueIdentity = $!patientAttributeValueMap.get( 17 ) )
            <select id="attr17" name="attr17" class='#validate( "default"  $attribute.mandatory )'>
                <option value="" selected="selected">[$i18n.getString( "please_select" )]</option>
                <option value="true" #if( $attributeValueIdentity =='true') selected="selected" #end >$i18n.getString( "yes" )</option>
                <option value="false" #if( $attributeValueIdentity=='false') selected="selected" #end >$i18n.getString( "no" )</option>
            </select>
		</td>
	</tr>

	<tr #alternate( false ) id="trattr26">	    
		<!-- Bank Account of ASHA opened  -->
		<td class='text-column'>Bank Account of ASHA opened</td>
		<td class="input-column" >
			#set( $attribute = $patientAttributeMap.get( 26 ) )
			#set( $attributeValueBank = $!patientAttributeValueMap.get( 26 ) )
            <select id="attr26" name="attr26" class='#validate( "default"  $attribute.mandatory )'>
                <option value="" selected="selected">[$i18n.getString( "please_select" )]</option>
                <option value="true" #if( $attributeValueBank =='true') selected="selected" #end >$i18n.getString( "yes" )</option>
                <option value="false" #if( $attributeValueBank=='false') selected="selected" #end >$i18n.getString( "no" )</option>
            </select>
		</td>
	</tr>
	
	<tr #alternate( false ) id="trattr27">	    
		<!-- If Yes, Mention Name of the Bank   -->
		<td class='text-column'>If Yes, Mention Name of the Bank</td>
		<td class="input-column" ><input type="text" id="attr27" name="attr27" class="{validate:{required:false ,unicodechars:true}}" value = "$!patientAttributeValueMap.get( 27 )" /></td>
	</tr>

	<tr #alternate( false ) id="trattr28">	    
		<!-- Account Number    -->
		<td class='text-column'>Account Number</td>
		<td class="input-column" ><input type="text" id="attr28" name="attr28" class="{validate:{required:false ,number:true}}" value = "$!patientAttributeValueMap.get( 28 )" /></td>
	</tr>


	<tr #alternate( false ) id="trattr29">	    
		<!-- Branch Name -->
		<td class='text-column'>Branch Name</td>
		<td class="input-column" ><input type="text" id="attr29" name="attr29" class="{validate:{required:false ,unicodechars:true}}" value = "$!patientAttributeValueMap.get( 29 )" /></td>
	</tr>
		
	<tr #alternate( false ) id="trattr33">	    
		<!-- Date of Cessation from ASHA Work -->
		<td class='text-column'>Date of Cessation from ASHA Work</td>
		#set( $attributeDate = $patientAttributeMap.get( 33 ) )
		<td class="input-column" ><input type="text" id="attr33" name="attr33" class=' #validate( "default"  $attributeDate.mandatory )'value = "$!patientAttributeValueMap.get( 33 )" /></td>
		<script type="text/javascript">
			datePickerValid( 'attr33' );
		</script> 
	</tr>


	<tr #alternate( false ) id="trattr185">	    
		<!-- Reason for Dropout( if Dropped ) -->
		<td class='text-column'>Reason for Dropout( if Dropped )</td>
		<td class="input-column" >
			#set( $attribute = $patientAttributeMap.get( 185 ) )
			#set( $attributeValueInactive = $!patientAttributeValueMap.get( 185 ) )	
			<select id="attr185" name="attr185" class='#validate( "default"  $attribute.mandatory )'onchange="validateMiscellaneousReason();">
			 	<option value="" selected="selected">[$i18n.getString( "please_select" )]</option>
			 	#foreach ($option in $attribute.attributeOptions )
			 		<option value="$option.id" #if($attributeValueInactive == $option.name ) selected="selected" #end >$option.name</option>
	 			#end
 			</select>
 		</td>
	</tr>

	<tr #alternate( false ) id="trattr207">	    
		<!-- Miscellaneous Reasons for ASHA Drop Out -->
		<td class='text-column'>Miscellaneous</td>
		<td class="input-column" >
			#set( $attribute = $patientAttributeMap.get( 207 ) )
			#set( $attributeValueMiscellaneous = $!patientAttributeValueMap.get( 207 ) )	
			<select id="attr207" name="attr207" class='#validate( "default"  $attribute.mandatory )'>
			 	<option value="" selected="selected">[$i18n.getString( "please_select" )]</option>
			 	#foreach ($option in $attribute.attributeOptions )
			 		<option value="$option.id" #if($attributeValueMiscellaneous == $option.name ) selected="selected" #end >$option.name</option>
	 			#end
 			</select>
 		</td>
	</tr>

</table>

<table width="100%">
	
	<tr><td>&nbsp;</td><td>&nbsp;</td></tr>

	<tr>
		<td>
			<input type="submit" class='button' value="$i18n.getString( 'update' )" >
			<!--<input type="button" class='button' value="$i18n.getString( 'back_to_registration' )" onclick="javascript:callAction( 'getRegisteredASHAList' )"/>-->
			<input type="button" class='button' value="$i18n.getString( 'back_to_registration' )" onclick="javascript:callAction( 'selectASHA' )"/>
		</td>
	</tr>
</table>

</form> 	
<script>
	dobTypeOnChange("updateASHAProfileForm");
	ageValidation();
	dobValidation();
	validateDateOfJoining();
	validateEducationLevel();
	validateMiscellaneousReason();
</script>	
