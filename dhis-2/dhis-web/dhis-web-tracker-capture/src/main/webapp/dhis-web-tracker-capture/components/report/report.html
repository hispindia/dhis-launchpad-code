<div class="bordered-div"  ng-controller="ReportController">
    <form name="outerForm" novalidate>               
        <div class="row">
            <div class="col-md-6">
                <table class="table-borderless">
                    <tr>
                        <td>{{'org_unit'| translate}}</td>
                        <td>                    
                            <label><input type="radio" ng-model="selectedOuMode.name" name="selected" value="SELECTED"> {{'SELECTED'| translate}}</label><br/>
                            <label><input type="radio" ng-model="selectedOuMode.name" name="children" value="CHILDREN"> {{'CHILDREN'| translate}}</label><br/>
                            <label><input type="radio" ng-model="selectedOuMode.name" name="descendants" value="DESCENDANTS"> {{'DESCENDANTS'| translate}}</label><br/>
                            <label><input type="radio" ng-model="selectedOuMode.name" name="accessible" value="ACCESSIBLE"> {{'ACCESSIBLE'| translate}}</label>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <table class="table-borderless table-with-fixed-layout">
                    <tr>
                        <td>
                            <input type="text" name="reportStartDate" placeholder="{{'start_date'| translate}} (yyyy-mm-dd)" class="form-control" ng-date ng-model="report.startDate" ng-required="true"/> 
                            <span ng-show="outerForm.submitted && outerForm.reportStartDate.$invalid" style="color:red;font-size:12px">{{'required'| translate}} (yyyy-mm-dd)</span>
                        </td>
                        <td>
                            <input type="text" name="reportEndDate" placeholder="{{'end_date'| translate}} (yyyy-mm-dd)" class="form-control" ng-date ng-model="report.endDate" ng-required="true"/>
                            <span ng-show="outerForm.submitted && outerForm.reportEndDate.$invalid" style="color:red;font-size:12px">{{'required'| translate}} (yyyy-mm-dd)</span>
                        </td>
                    </tr>
                </table>                
            </div>
            <div class="col-md-6 trim">                  
                <button type="button" class="btn btn-primary" ng-click="generateReport()" ng-disabled="!selectedProgram">{{'go'| translate}}</button>
                <button type="button" class="btn btn-default small-horizonal-spacing" ng-click="showReport()">{{'close'| translate}}</button>
            </div>
        </div>
    </form>
    <div class="row" ng-if="programs.length < 1">        
        <div class="col-md-12 vertical-spacing">
            <div class="alert alert-warning">{{'no_program_exists_report'| translate}}</div> 
        </div>
    </div>
    <div class="row" ng-if="programs.length > 0 && !selectedProgram">        
        <div class="col-md-12 vertical-spacing">
            <div class="alert alert-warning">{{'please_select_program_report'| translate}}</div> 
        </div>
    </div>
    <div ng-if="dataReady">
        <div ng-switch="teiCount">                    
            <div ng-switch-when="undefined">
                <div class="alert alert-warning vertical-spacing">
                    {{'no'| translate}} {{selectedProgram.trackedEntity.name|| 'records' | translate}} {{'found'| translate}}                        
                </div>
            </div>
            <div ng-switch-when="0">  
                <div class="alert alert-warning vertical-spacing">
                    {{'no'| translate}} {{selectedProgram.trackedEntity.name|| 'records' | translate}} {{'found'| translate}}                        
                </div>
            </div>    
            <div ng-switch-default> 

                <!-- report begins -->
                <div class="vertical-spacing">                    
                    <table class="table table-compact table-striped">
                        <thead>
                            <tr>
                                <th>{{selectedProgram.trackedEntity.name}}</th>
                                <th>{{selectedProgram.name}} {{'visit' | translate}}</th>
                            </tr>
                        </thead>
                        <tr ng-repeat="tei in teiList.rows">
                            <td>
                                <span ng-repeat="gridColumn in gridColumns">
                                    <span class="bold">{{gridColumn.name}}:</span> {{tei[gridColumn.id]}}<br>
                                </span>
                            </td>
                            <td class='vertical-center'>    
                                <div class='bold inline-block' ng-if='!dhis2Events[tei.id]'>{{'no_visit_made' | translate}}</div>
                                <div class="inline-block" ng-repeat="ev in dhis2Events[tei.id] | orderBy: 'eventDate'">                                    
                                    <div class="block align-center">{{ev.orgUnitName}}</div>                   
                                    <div class="empty-stage-container" 
                                         title="{{'no_data' | translate}}"
                                         ng-class="{'{{ev.statusColor}}': true}"
                                         ng-if='!ev.dataValues'>
                                        {{ev.name}}<br/>
                                        {{ev.eventDate}}<br>
                                        {{'no_data' | translate}}
                                    </div>
                                    <div class="stage-container" 
                                         title="{{'details' | translate}}"
                                         ng-class="{'{{ev.statusColor}}': true}"
                                         ng-if='ev.dataValues'
                                         ng-click="showEventDetails(ev, tei)">
                                        {{ev.name}}<br/>
                                        {{ev.eventDate}}<br>  
                                        {{'data_exists' | translate}}
                                    </div>                                    
                                    <span><i class="fa fa-arrow-right" ng-show="$index < dhis2Events[tei.id].length - 1"></i></span>
                                </div>                                         
                            </td>
                        </tr>
                    </table>
                </div>
                <!-- report ends -->
            </div>
        </div> 
    </div>
</div>
